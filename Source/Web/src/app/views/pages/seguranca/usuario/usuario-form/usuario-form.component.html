<kt-portlet>
    <kt-portlet-header [sticky]="false" [title]="titulo" [class]="'kt-portlet__head--lg'">

        <ng-container ktPortletTools>

            <a (click)="exibirModal(content7)" class="btn btn-secondary kt-margin-r-10" mat-raised-button
                matTooltip="Retornar à lista de usuários">
                <i class="la la-arrow-left"></i>
                <span class="kt-hidden-mobile">Cancelar</span>
            </a>

            <button *ngIf="!modoEdicao" mat-raised-button class="kt-margin-r-10 btn-success"
                (click)="exibirModal(content9)">
                Editar
            </button>

            <button *ngIf="!modoEdicao" mat-raised-button color="warn" class="kt-margin-r-10"
                (click)="exibirModal(content11)">
                Excluir
            </button>

            <button *ngIf="modoEdicao" mat-raised-button color="primary" class="kt-margin-r-10"
                (click)="exibirModal(content10)">
                Salvar
            </button>



        </ng-container>
    </kt-portlet-header>
    <kt-portlet-body>

        <div>
            <!--begin::Form-->
            <form [ngClass]="{'modoVisualizacao': !modoEdicao}" *ngIf="usuario | async; else loading"
                [formGroup]="usuarioForm" class="kt-form">
                <kt-alert *ngIf="hasFormErrors" type="warn" [showCloseButton]="true" [duration]="10000"
                    (close)="onAlertClose($event)">
                    <b>Erro ao salvar o usuário.</b>&nbsp;Realize as correções e tente novamente.
                </kt-alert>

                <input formControlName="CD_USR" type="hidden">

                <div class="kt-form__section kt-form__section--first">
                    <div class="">
                        <div class="row">

                            <div class="form-group row col-lg-6">
                                <label class="col-lg-2 col-form-label">Nome:</label>
                                <div class="col-lg-8 example-container">
                                    <mat-form-field class="col-lg-12">
                                        <input matInput placeholder="Digite o Nome do usuário"
                                            formControlName="TX_NOME">
                                        <mat-error>
                                            O campo Nome é <strong>obrigatório</strong>
                                        </mat-error>
                                    </mat-form-field>

                                </div>
                            </div>

                            <div class="form-group row col-lg-6">
                                <label class="col-lg-2 col-form-label">Login:</label>
                                <div class="col-lg-8 example-container">
                                    <mat-form-field class="col-lg-12">
                                        <input matInput placeholder="Digite o Login do usuário"
                                            formControlName="TX_LOGIN">
                                        <mat-error>
                                            O campo Login é <strong>obrigatório</strong>
                                        </mat-error>
                                    </mat-form-field>

                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="">
                        <div class="row">

                            <div class="form-group row col-lg-6">
                                <label class="col-lg-2 col-form-label">Senha:</label>
                                <div class="col-lg-8 example-container">
                                    <mat-form-field class="col-lg-12">
                                        <input matInput placeholder="Digite a Senha do usuário"
                                            formControlName="TX_SENHA">
                                        <mat-error>
                                            O campo Senha é <strong>obrigatório</strong>
                                        </mat-error>
                                    </mat-form-field>

                                </div>
                            </div>

                            <div class="form-group row col-lg-6">
                                <label class="col-lg-2 col-form-label">Confirmação de Senha:</label>
                                <div class="col-lg-8 example-container">
                                    <mat-form-field class="col-lg-12">
                                        <input matInput placeholder="Confirme a senha do usuário"
                                            formControlName="CONFIRMA_SENHA">
                                        <mat-error>
                                            O campo Confirmação de Senha é <strong>obrigatório</strong>
                                        </mat-error>
                                    </mat-form-field>

                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="">
                        <div class="row">


                            <div class="form-group row col-lg-6">
                                <label class="col-lg-2 col-form-label">Status:</label>
                                <div class="col-lg-8 example-container">
                                    <mat-form-field class="col-lg-12">
                                        <mat-select placeholder="Selecione o Status do usuário"
                                            formControlName="OP_STATUS">
                                            <mat-option value="{{status.OP_STATUS}}"
                                                *ngFor="let status of listaStatus;">
                                                {{status.TX_DESC}}
                                            </mat-option>
                                        </mat-select>
                                        <mat-error>
                                            O campo Status é <strong>obrigatório</strong>
                                        </mat-error>
                                    </mat-form-field>

                                </div>
                            </div>


                        </div>
                    </div>

                </div>
            </form>
        </div>
        <br />
        <br />

        <div class="kt-section">
            <div class="kt-section__content">
                <ngb-tabset>
                    <ngb-tab title="Módulos">
                        <ng-template ngbTabContent *ngIf="usuario | async">


                            <div class="row" [ngClass]="{'modoVisualizacao': !modoEdicao}">
                                <div class="col-lg-6">

                                    <table id="table-origem-md" class="table">
                                        <thead class="thead-themed">
                                            <tr>
                                                <th>Módulos:</th>
                                                <th width="100px"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let modulo of listaModulos; let i = index">
                                                <td>{{modulo.TX_DSC}}</td>
                                                <td class="text-center" (click)="adicionarModulo(modulo,i)">
                                                    <i style="font-weight:bold;cursor:pointer"
                                                        class="la la-plus-circle text-success bt-selecao-md"></i>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-lg-6">

                                    <table id="table-origem-md" class="table">
                                        <thead class="thead-themed">
                                            <tr>
                                                <th>Módulos associados ao usuário:</th>
                                                <th width="100px"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let modulo of listaModulosSelecionados; let i = index">
                                                <td>{{modulo.TX_DSC}}</td>
                                                <td class="text-center" (click)="removerModulo(modulo,i)">
                                                    <i style="font-weight:bold;cursor:pointer"
                                                        class="la la-times-circle-o text-danger"></i>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>




                        </ng-template>
                    </ngb-tab>
                    <ngb-tab title="Grupos">
                        <ng-template ngbTabContent *ngIf="usuario | async">

                            <div class="row" [ngClass]="{'modoVisualizacao': !modoEdicao}">
                                <div class="col-lg-6">

                                    <table id="table-origem-md" class="table">
                                        <thead class="thead-themed">
                                            <tr>
                                                <th>Grupos:</th>
                                                <th width="100px"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let grupo of listaGrupos;let i = index">
                                                <td>{{grupo.TX_DSC}}</td>
                                                <td class="text-center" (click)="adicionarGrupo(grupo,i)">
                                                    <i style="font-weight:bold;cursor:pointer"
                                                        class="la la-plus-circle text-success bt-selecao-md"></i>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-lg-6">

                                    <table id="table-origem-md" class="table">
                                        <thead class="thead-themed">
                                            <tr>
                                                <th>Grupos associados ao usuário:</th>
                                                <th width="100px"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let grupo of listaGruposSelecionados;let i = index">
                                                <td>{{grupo.TX_DSC}}</td>
                                                <td class="text-center" (click)="adicionarGrupo(grupo,i)">
                                                    <i style="font-weight:bold;cursor:pointer"
                                                        class="la la-times-circle-o text-danger"></i>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>





                        </ng-template>
                    </ngb-tab>
                    <ngb-tab title="Rotinas">
                        <ng-template ngbTabContent>

                            <mat-card>
                                <div class="row" style="height: 50px;" [ngClass]="{'modoVisualizacao': !modoEdicao}">

                                    <div class="form-group row col-lg-5">
                                        <label class="col-lg-2 col-form-label">Serviço:</label>
                                        <div class="col-lg-8 example-container">
                                            <mat-form-field class="col-lg-12">
                                                <mat-select [(ngModel)]="cdSrvSelecionado"
                                                    placeholder="Selecione um serviço">
                                                    <mat-option value="{{servico.CD_SRV}}"
                                                        *ngFor="let servico of listaServicos;">
                                                        {{servico.TXT_DEC}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                        </div>
                                    </div>

                                    <div class="form-group row col-lg-5">
                                        <label class="col-lg-2 col-form-label">Rotina:</label>
                                        <div class="col-lg-8 example-container">
                                            <mat-form-field class="col-lg-12">
                                                <mat-select [(ngModel)]="cdRotSelecionada"
                                                    placeholder="Selecione uma rotina"
                                                    [disabled]="cdSrvSelecionado == 0 || filtrarRotinas(cdSrvSelecionado).length == 0">
                                                    <mat-option value="{{rotina.CD_ROT}}"
                                                        *ngFor="let rotina of filtrarRotinas(cdSrvSelecionado);">
                                                        {{rotina.TX_NOME}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                        </div>
                                    </div>

                                    <div class="col-lg-1">
                                        <button (click)="adicionarRotina()" mat-raised-button color="primary"
                                            matTooltip="Adicionar rotina ao usuário">
                                            <i style="font-size: 20px;" class="la la-plus"></i>
                                        </button>
                                    </div>

                                </div>

                            </mat-card>

                            <br />
                            <br />

                            <table id="table-origem-md" class="table" [ngClass]="{'modoVisualizacao': !modoEdicao}">
                                <thead class="thead-themed">
                                    <tr>
                                        <th>Rotina:</th>
                                        <th *ngFor="let operacao of listaOperacoes">
                                            {{operacao.TX_DSC}}
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let rotinaOp of listaRotinaOperacoesSelecionadas">
                                        <td>
                                            {{rotinaOp.rotina.TX_NOME}}
                                        </td>
                                        <td *ngFor="let op of rotinaOp.operacoes">
                                            <mat-checkbox [(ngModel)]="op.selecionada"></mat-checkbox>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>






                        </ng-template>
                    </ngb-tab>
                </ngb-tabset>
            </div>
        </div>



    </kt-portlet-body>
</kt-portlet>



<div class="kt-section">
    <div class="kt-section__content">
        <ng-template #content7 let-c="close" let-d="dismiss">
            <div class="modal-header">
                <h4 class="modal-title">Cancelar Alterações</h4>
                <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>
                    Deseja cancelar as alterações realizadas e retornar à listagem de usuários?
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="c('Close click')">Cancelar</button>
                <button type="button" class="btn btn-danger" (click)="cancelar()">Confirmar</button>
            </div>
        </ng-template>
    </div>
</div>

<div class="kt-section">
    <div class="kt-section__content">
        <ng-template #content9 let-c="close" let-d="dismiss">
            <div class="modal-header">
                <h4 class="modal-title">Editar Registro</h4>
                <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>
                    Deseja editar o registro?
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="c('Close click')">Cancelar</button>
                <button type="button" class="btn btn-success" (click)="habilitarEdicao()">Confirmar</button>
            </div>
        </ng-template>
    </div>
</div>

<div class="kt-section">
    <div class="kt-section__content">
        <ng-template #content10 let-c="close" let-d="dismiss">
            <div class="modal-header">
                <h4 class="modal-title">Salvar Registro</h4>
                <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>
                    Deseja salvar o registro?
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="c('Close click')">Cancelar</button>
                <button type="button" class="btn btn-success" (click)="salvar()">Confirmar</button>
            </div>
        </ng-template>
    </div>
</div>

<div class="kt-section">
    <div class="kt-section__content">
        <ng-template #content11 let-c="close" let-d="dismiss">
            <div class="modal-header">
                <h4 class="modal-title">Confirmar  exclusão do registro</h4>
                <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <kt-alert type="warn" [showCloseButton]="false">
                    <p>O registro será definitivamente removido do banco de dados!</p>
                </kt-alert>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="c('Close click')">Cancelar</button>
                <button type="button" class="btn btn-danger" (click)="excluir()">Confirmar</button>
            </div>
        </ng-template>
    </div>
</div>

<div class="kt-section">
    <div class="kt-section__content">
        <ng-template #content8>
            <div class="modal-body">
                <p>
                    Salvando as informações do registro. Por favor, aguarde.<mat-spinner [diameter]="20"></mat-spinner>
                </p>
            </div>
        </ng-template>
    </div>
</div>

<div class="kt-section">
        <div class="kt-section__content">
            <ng-template #content12>
                <div class="modal-body">
                    <p>
                        Exluindo o registro. Por favor, aguarde.<mat-spinner [diameter]="20"></mat-spinner>
                    </p>
                </div>
            </ng-template>
        </div>
    </div>